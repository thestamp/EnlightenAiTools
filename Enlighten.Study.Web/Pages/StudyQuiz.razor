@page "/quiz"

@using Enlighten.Data.Models
@inherits StudyQuizBase

<MudText Typo="Typo.h3" GutterBottom="true">Quiz</MudText>
<MudText Class="mb-8">Test your skills for an upcoming exam! (As part of a balanced study!)</MudText>

<MudContainer>
    <MudPaper Elevation="2" Rounded="true" Class="p-4 my-4">
        
        <MudSelect T="Textbook" Label="Select Textbook" Variant="Variant.Outlined" AnchorOrigin="Origin.BottomCenter" @bind-Value="@SelectedTextbook" >
            @foreach (var item in Textbooks)
            {
                <MudSelectItem Value="@item">@item.Name</MudSelectItem>
            }
        </MudSelect>
        

        <MudSelect T="TextbookUnit" Label="Select Unit" Variant="Variant.Outlined" AnchorOrigin="Origin.BottomCenter" @bind-Value="@SelectedUnit" Disabled="IsRandomUnit">
            @if (SelectedTextbook != null)
            {
                @foreach (var item in SelectedTextbook.Units)
                {
                    <MudSelectItem Value="@item">@item.Name</MudSelectItem>
                }
            }
           
        </MudSelect>

        <MudCheckBox T="bool" Label="Random Unit" @bind-Checked="@IsRandomUnit"></MudCheckBox>

        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="GenerateQuestion" Class="mt-4" Disabled="SelectedTextbook == null || (SelectedUnit == null && !IsRandomUnit)">
            @if (_processing)
            {
                <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true"/>
                <MudText Class="ms-2">Processing</MudText>
            }
            else
            {
                <MudText>Generate Question</MudText>
            }

        </MudButton>


    </MudPaper>
    
    <br /><br />
        
    @if (!string.IsNullOrEmpty(botQuestion))
        {

            <MudCard>
                <MudCardContent>
                    <MudMarkdown Value="@botQuestion"/>

                <MudTextField Immediate="true" @ref="txtAnswer" @bind-Value="@userAnswer" Label="Your Answer" Multiline="true" Rows="2" Variant="Variant.Outlined" Class="mt-4" Disabled="_processing"  OnKeyDown="OnKeyDown" />

                </MudCardContent>
                <MudCardActions>
                <MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="GenerateResponseAnswer" Class="mt-4" >
                        @if (_processing)
                        {
                            <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true"/>
                            <MudText Class="ms-2">Processing</MudText>
                        }
                        else
                        {
                            <MudText>Submit Answer</MudText>
                        }

                    </MudButton>
                </MudCardActions>
            </MudCard>


            
            
            <br><br />
        
            @if (hasAnswer)
            {
                if (isCorrect)
                {
                    <MudAlert Severity="Severity.Success">@botAnswerResponse</MudAlert>

                <MudButton @ref="NextQuestionButton" Variant="Variant.Filled" Color="Color.Success" OnClick="GenerateQuestion" Class="mt-4" Disabled="SelectedUnit == null && !IsRandomUnit">
                        @if (_processing)
                        {
                            <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true"/>
                            <MudText Class="ms-2">Processing</MudText>
                        }
                        else
                        {
                            <MudText>Press Enter for Next Question</MudText>
                        }

                    </MudButton>
                }
                else
                {
                    if (isSomewhatCorrect)
                    {
                        <MudAlert Severity="Severity.Warning">@botAnswerResponse</MudAlert>
                    }
                    else
                    {
                        <MudAlert Severity="Severity.Error">@botAnswerResponse</MudAlert>
                    }
                
                }
            }
        }

 
</MudContainer>